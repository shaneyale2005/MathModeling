# 情感演化动力学模型 - 快速上手指南

## 项目概述

这是一个基于动力学方程的网络舆情情感演化分析系统，能够：
1. **分析情感传播规律**：基于SIR模型改进的情感传播动力学
2. **预测情感走向**：通过数学模型预测积极/消极情感的演化趋势
3. **舆情预警**：识别可能的舆情危机，提前预警

## 核心数学模型

### 1. 情感演化动力学方程组
```
dS/dt = -βp·Ip·S - βn·In·S + γ·R    (中立群体变化)
dIp/dt = βp·Ip·S - αp·Ip             (积极情感群体变化)  
dIn/dt = βn·In·S - αn·In             (消极情感群体变化)
dR/dt = αp·Ip + αn·In - γ·R          (退出群体变化)
```

**状态变量含义：**
- S：中立情感用户比例
- Ip：积极情感用户比例  
- In：消极情感用户比例
- R：退出讨论用户比例

**参数含义：**
- βp, βn：积极/消极情绪传播率
- αp, αn：积极/消极情绪消退率
- γ：用户重新参与讨论速率

### 2. 预警系统特征
- **情感强度**：In(t) - 消极情感比例
- **情感变化率**：dIn/dt - 消极情感变化速度
- **传播力指标**：P(t) = ln(1 + 总互动量)
- **模型预测值**：M(t) - 下一时刻消极情感预测

## 项目文件结构

```
Modeling/
├── main.py              # 主程序入口
├── config.py            # 配置文件
├── data_loader.py       # 数据加载和预处理
├── feature_engineer.py  # 特征工程
├── dynamics_model.py    # 动力学模型实现
├── warning_system.py    # 预警系统
├── visualization.py     # 可视化模块
├── requirements.txt     # 依赖包
├── dataset/            
│   └── data.csv         # 原始数据
└── results/            # 输出结果
    ├── dynamics_params.npy
    ├── sentiment_trends.png
    ├── model_validation.png
    └── warning_model.pkl
```

## 数据字段说明

| 字段名 | 类型 | 描述 |
|--------|------|------|
| content_id | 字符串 | 内容唯一标识符 |
| text | 字符串 | 原始文本内容 |
| clean_text | 字符串 | 清洗处理后的文本 |
| publish_time | 日期时间 | 内容发布时间 |
| sentiment_score | 浮点数 | 情感量化得分(-1到1) |
| sentiment_label | 字符串 | 情感分类标签 |
| emotion_keywords | 列表 | 情感关键词 |
| confidence | 浮点数 | 情感分析置信度 |
| user_id | 字符串 | 用户唯一标识符 |
| user_followers | 整数 | 用户粉丝数 |
| user_region | 字符串 | 用户所在地区 |
| repost_count | 整数 | 被转发次数 |
| comment_count | 整数 | 被评论次数 |
| quote_count | 整数 | 被引用次数 |

## 快速运行

### 1. 环境准备
```bash
pip install -r requirements.txt
```

### 2. 运行分析
```bash
python main.py
```

### 3. 查看结果
- `results/sentiment_trends.png` - 情感趋势图
- `results/model_validation.png` - 模型验证结果
- `results/dynamics_params.npy` - 优化后的动力学参数
- `results/warning_model.pkl` - 训练好的预警模型

## 核心工作流程

### 第一步：数据预处理
1. 加载CSV数据
2. 时间格式标准化
3. 情感标签修正（基于sentiment_score阈值）
4. 数据清洗和异常值处理

### 第二步：特征工程
1. **时间窗口聚合**：按6小时窗口聚合数据
2. **情感比例计算**：计算每个时间窗口的正面/负面/中性比例
3. **传播指标**：计算互动量（转发+评论+引用）
4. **影响力权重**：基于用户粉丝数加权

### 第三步：动力学模型训练
1. **参数初始化**：β=[0.5,0.5], α=[0.1,0.1], γ=0.05
2. **数值求解**：使用RK45方法求解微分方程组
3. **参数优化**：L-BFGS-B算法最小化预测误差
4. **约束条件**：β∈[0,1], α∈[0,1], γ∈[0,0.2]

### 第四步：预警系统
1. **特征构建**：[In, dIn/dt, P(t), M(t)]
2. **标签生成**：基于阈值判断是否为危机状态
3. **模型训练**：逻辑回归分类器
4. **预警输出**：危机概率和预警等级

## 关键配置参数

```python
# config.py 中的重要参数
TIME_WINDOW = '6h'                    # 时间窗口大小
TRAIN_SIZE = 0.7                      # 训练集比例
POSITIVE_THRESHOLD = 0.3              # 积极情感阈值
NEGATIVE_THRESHOLD = -0.3             # 消极情感阈值
NEGATIVE_RATIO_THRESHOLD = 0.4        # 预警-消极比例阈值
SENTIMENT_CHANGE_THRESHOLD = -0.15    # 预警-情感变化阈值
INTERACTION_CHANGE_THRESHOLD = 500    # 预警-互动变化阈值
```

## 模型解释

### 动力学方程的物理意义：
1. **传播项 βp·Ip·S**：积极情感用户感染中立用户的速率
2. **消退项 αp·Ip**：积极情感用户转为退出状态的速率
3. **回流项 γ·R**：退出用户重新成为中立用户的速率

### 预警机制：
- **多维度监控**：同时监控情感强度、变化率、传播力和模型预测
- **阈值触发**：任一指标超过阈值即触发预警
- **概率输出**：给出危机发生的概率，而非简单的是/否判断

## 下一步优化方向

1. **模型改进**：考虑地域因素、用户影响力权重
2. **特征增强**：添加话题热度、关键词变化等特征
3. **实时预警**：接入实时数据流，实现在线预警
4. **可解释性**：增加模型决策的可解释性分析

## 常见问题

**Q: 模型收敛失败怎么办？**
A: 调整初始参数和边界约束，或增加正则化项

**Q: 预警准确率不高？**
A: 调整预警阈值，或增加更多特征维度

**Q: 数据量不足？**
A: 考虑数据增强或调整时间窗口大小
